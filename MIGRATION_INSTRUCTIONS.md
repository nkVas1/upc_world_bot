# üîß –ò–ù–°–¢–†–£–ö–¶–ò–Ø: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ photo_url –Ω–∞ Railway

**–î–∞—Ç–∞:** 25 —è–Ω–≤–∞—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é  
**–§–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏:** `alembic/versions/002_add_photo_url_field.py`

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –û—à–∏–±–∫–∞ –≤ –ª–æ–≥–∞—Ö

**–û—à–∏–±–∫–∞:** `column users.photourl does not exist`

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ:
- –ú–æ–¥–µ–ª—å User –≤ –∫–æ–¥–µ –∏–º–µ–µ—Ç –ø–æ–ª–µ `photo_url`
- –ù–æ –≤ –ë–î PostgreSQL —ç—Ç–æ–π –∫–æ–ª–æ–Ω–∫–∏ –Ω–µ—Ç
- **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é Alembic

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–¥–µ–ª—å User –≤ –∫–æ–¥–µ
**–§–∞–π–ª:** `bot/database/models.py`

```python
class User(Base):
    __tablename__ = "users"
    
    # ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è ...
    photo_url: Mapped[Optional[str]] = mapped_column(String(500), nullable=True)  # ‚úÖ –ï–°–¢–¨
```

‚úÖ **–°—Ç–∞—Ç—É—Å:** –ü–æ–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –º–æ–¥–µ–ª—å

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
**–§–∞–π–ª:** `alembic/versions/002_add_photo_url_field.py`

```python
revision = '002_add_photo_url'
down_revision = '001_initial'  # ‚Üê –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Å–≤—è–∑–∞–Ω–∞ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –º–∏–≥—Ä–∞—Ü–∏–µ–π

def upgrade() -> None:
    op.add_column('users', sa.Column('photo_url', sa.String(length=500), nullable=True))

def downgrade() -> None:
    op.drop_column('users', 'photo_url')
```

‚úÖ **–°—Ç–∞—Ç—É—Å:** –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ `photourl`
–í –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: `photo_url` (—Å underscore) ‚úÖ

---

## üöÄ –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ Alembic (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–õ–æ–∫–∞–ª—å–Ω–æ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è):**
```bash
cd upc_world_bot
alembic upgrade head
```

**–ù–∞ Railway (—á–µ—Ä–µ–∑ SSH –∏–ª–∏ CLI):**
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ Railway –∏–ª–∏ —á–µ—Ä–µ–∑ –∏—Ö CLI
railway shell

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd /app

# –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head
```

### –°–ø–æ—Å–æ–± 2: –ü—Ä—è–º–æ–π SQL –∑–∞–ø—Ä–æ—Å (–±—ã—Å—Ç—Ä–æ)

**–ù–∞ Railway –≤ PostgreSQL –∫–æ–Ω—Å–æ–ª–∏:**
```sql
ALTER TABLE users ADD COLUMN photo_url VARCHAR(500);
```

### –°–ø–æ—Å–æ–± 3: –ß–µ—Ä–µ–∑ Docker (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

```bash
# –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –Ω–∞ Railway
docker exec <container_id> alembic upgrade head
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–ª–æ–Ω–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞
**SQL –∑–∞–ø—Ä–æ—Å:**
```sql
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'users' AND column_name = 'photo_url';
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
column_name | data_type
photo_url   | character varying
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞
–û—à–∏–±–∫–∞ `column users.photourl does not exist` –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å ‚úÖ

### 3. –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å
–í –∫–æ–¥–µ –≤–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `photo_url` (—Å underscore) ‚úÖ

---

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –î–µ—Ç–∞–ª–∏ |
|-----------|--------|--------|
| **–ú–æ–¥–µ–ª—å User** | ‚úÖ | `photo_url` field –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ `bot/database/models.py` |
| **–ú–∏–≥—Ä–∞—Ü–∏—è** | ‚úÖ | `002_add_photo_url_field.py` —Å–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è |
| **–ö–æ–¥** | ‚úÖ | –í—Å–µ —Å—Å—ã–ª–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `photo_url` —Å underscore |
| **–ë–î Railway** | ‚è≥ | –ù—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é |
| **–õ–æ–≥–∏** | ‚è≥ | –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ—à–∏–±–∫–∞ –∏—Å—á–µ–∑–Ω–µ—Ç |

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (—É–∂–µ —Å–¥–µ–ª–∞–Ω—ã)

‚úÖ `bot/services/user_service.py` - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ photo_url  
‚úÖ `bot/api_server.py` - –í–æ–∑–≤—Ä–∞—Ç photo_url –≤ API  
‚úÖ `bot/handlers/profile.py` - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ photo_url  
‚úÖ `bot/keyboards/inline.py` - –ü–µ—Ä–µ–¥–∞—á–∞ referral_code  

---

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

### –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
```bash
alembic downgrade -1  # –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –º–∏–≥—Ä–∞—Ü–∏–π
```bash
alembic current  # –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –ë–î
alembic history  # –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```sql
-- –°–ø–∏—Å–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ users
\d users  -- –≤ psql
-- –∏–ª–∏
DESCRIBE users;  -- –≤ –¥—Ä—É–≥–∏—Ö –ë–î

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
SELECT * FROM pg_extension;
```

---

## üìù –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è Railway

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Railway CLI:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å
railway link

# –û—Ç–∫—Ä–æ–π—Ç–µ shell –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
railway shell

# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
cd /app && alembic upgrade head

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
alembic current
```

---

## ‚ú® –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

‚úÖ –û—à–∏–±–∫–∞ `column users.photourl does not exist` –∏—Å—á–µ–∑–Ω–µ—Ç  
‚úÖ –ê–≤–∞—Ç–∞—Ä—ã –±—É–¥—É—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ –ë–î  
‚úÖ API –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `photo_url` –≤ –æ—Ç–≤–µ—Ç–∞—Ö  
‚úÖ QR-–∫–æ–¥—ã –∏ WebApp –∫–Ω–æ–ø–∫–∏ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  

---

**–°—Ç–∞—Ç—É—Å:** –ú–∏–≥—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –Ω–∞ Railway üöÄ

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ —É–∂–µ —Å–¥–µ–ª–∞–Ω—ã. –û—Å—Ç–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ PostgreSQL –Ω–∞ Railway.
