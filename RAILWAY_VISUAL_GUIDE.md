# 🎬 RAILWAY SETUP - ПОШАГОВАЯ ВИЗУАЛЬНАЯ ИНСТРУКЦИЯ

**Предназначена для**: Пользователей которые впервые деплоят на Railway  
**Время выполнения**: 15-20 минут  
**Сложность**: ⭐⭐ Средняя

---

## 📋 ПРЕДВАРИТЕЛЬНЫЕ ТРЕБОВАНИЯ

Перед началом убедитесь что у вас есть:

- [ ] **BOT_TOKEN** от @BotFather
  - Получить: https://t.me/BotFather → /newbot
  - Формат: `123456789:ABCDEFGhijklmnopqrstuvwxyz`

- [ ] **BOT_USERNAME** (имя вашего бота без @)
  - Получить: https://t.me/@YourBotName
  - Формат: `my_cool_bot_name`

- [ ] **GitHub аккаунт** с репозиторием `upc_world_bot`
  - Repository: https://github.com/nkVas1/upc_world_bot

- [ ] **Railway аккаунт** (создается через GitHub)
  - Регистрация: https://railway.app

---

## 🚀 ПОШАГОВАЯ ИНСТРУКЦИЯ

### ШАГ 1️⃣: Создайте Railway проект

**1. Откройте https://railway.app**

```
┌─────────────────────────────────────────────────────────┐
│ Railway.app                                             │
│ ┌───────────────────────────────────────────────────┐  │
│ │ [Login with GitHub]  [Create Account]             │  │
│ └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

**2. Кликнете "Login with GitHub"**
   - Авторизуйтесь своим GitHub аккаунтом
   - Дайте Railway доступ к вашим репозиториям

**3. После логина вы увидите Dashboard**

```
┌─────────────────────────────────────────────────────────┐
│ Railway Dashboard                                       │
│ ┌───────────────────────────────────────────────────┐  │
│ │ [+ New Project] [Pricing] [Docs]                  │  │
│ └───────────────────────────────────────────────────┘  │
│                                                         │
│ Your Projects:                                          │
│ ┌─────────────────────────────────────────────────┐   │
│ │ (тут будут ваши проекты)                        │   │
│ └─────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

**4. Кликнете голубую кнопку "[+ New Project]"** в верхнем левом углу

```
┌─────────────────────────────────────────────────────────┐
│ New Project Dialog                                      │
│ ┌───────────────────────────────────────────────────┐  │
│ │ ☐ Empty Project                                  │  │
│ │ ☑ Deploy from GitHub repo    ← ВЫБЕРИТЕ ЭТО!   │  │
│ │ ☐ Create from template                          │  │
│ └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

**5. Выберите "Deploy from GitHub repo"** и кликнете

```
┌─────────────────────────────────────────────────────────┐
│ Select Repository                                       │
│ ┌───────────────────────────────────────────────────┐  │
│ │ Search: [████████ upc_world_bot ░░░░]            │  │
│ │                                                   │  │
│ │ Repositories:                                     │  │
│ │ ☑ nkVas1/upc_world_bot                          │  │
│ │   ☐ TG_UPbot-main                                │  │
│ │   ☐ other-repo                                   │  │
│ │                                                   │  │
│ │ [Cancel] [Import]                                │  │
│ └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

**6. Выберите `nkVas1/upc_world_bot` и кликнете "Import"**

**7. Railway начнет деплой автоматически**

```
Status: 🔄 Building...
```

⚠️ **ВАЖНО**: Деплой БУДЕТ ОШИБАТЬСЯ - это нормально! Нам нужны переменные и БД.

---

### ШАГ 2️⃣: Создайте PostgreSQL базу данных

**1. В левой панели проекта кликнете "+ New"** (или "+ Add Service")

```
┌─────────────────────────────────────────────────────────┐
│ upc_world_bot Project                                   │
│ ┌───────────────────────────────────────────────────┐  │
│ │ Services:                                         │  │
│ │ ┌─────────────────────────────────────────────┐  │  │
│ │ │ + New    [upc_world_bot] [postgres-...] ... │  │  │
│ │ └─────────────────────────────────────────────┘  │  │
│ └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

**2. Кликнете "+ New"** в верхнем левом углу

```
┌─────────────────────────────────────────────────────────┐
│ What do you want to add?                                │
│ ┌───────────────────────────────────────────────────┐  │
│ │ [Database]  ← ВЫБЕРИТЕ  [Service]  [Template]    │  │
│ │                                                   │  │
│ │ Databases:                                        │  │
│ │ ☑ PostgreSQL    ← ВЫБЕРИТЕ ЭТО!                 │  │
│ │ ☐ MySQL                                          │  │
│ │ ☐ MongoDB                                        │  │
│ │ ☐ Redis                                          │  │
│ │ ☐ ... (other databases)                         │  │
│ └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

**3. Кликнете "PostgreSQL"**

```
Railway автоматически создаст базу и покажет статус 🟢
```

**4. Дождитесь статуса 🟢 (это займет ~1-2 минуты)**

```
✅ PostgreSQL
└─ Status: 🟢 Running
└─ Version: 15.0
└─ Region: oregon
```

---

### ШАГ 3️⃣: Скопируйте DATABASE_URL

**1. Кликнете на PostgreSQL сервис** в левой панели

```
┌─────────────────────────────────────────────────────────┐
│ PostgreSQL Settings                                     │
│ ┌───────────────────────────────────────────────────┐  │
│ │ Tabs: [Data] [Variables] [Settings] [Logs]       │  │
│ └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

**2. Откройте вкладку "Variables"**

```
┌─────────────────────────────────────────────────────────┐
│ Variables                                               │
│ ┌───────────────────────────────────────────────────┐  │
│ │ DATABASE_URL                                      │  │
│ │ [postgresql://postgres:xxx@oregon-postgres... ✓] │  │
│ │                                                   │  │
│ │ DATABASE_PRIVATE_URL                             │  │
│ │ [postgresql://... ]                              │  │
│ │                                                   │  │
│ │ PGHOST, PGPASSWORD, PGPORT, ...                 │  │
│ └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

**3. Скопируйте `DATABASE_URL`**
   - Нажмите на значок копирования рядом с переменной
   - **ЗАПОМНИТЕ**: она начинается с `postgresql://` (НЕ `postgresql+asyncpg://`)

---

### ШАГ 4️⃣: Создайте Redis для кэша

**1. Кликнете "+ New"** еще раз

**2. Выберите **Database** → **Redis**

```
Postgres + Redis - идеальная комбинация для бота!
```

**3. Дождитесь статуса 🟢** (~1-2 минуты)

```
✅ Redis
└─ Status: 🟢 Running
└─ Region: oregon
```

---

### ШАГ 5️⃣: Установите переменные в боте

**1. Кликнете на сервис бота** (основной проект, не PostgreSQL и не Redis)

```
┌─────────────────────────────────────────────────────────┐
│ upc_world_bot Service Settings                          │
│ ┌───────────────────────────────────────────────────┐  │
│ │ Tabs: [Deploy] [Build] [Variables] [Settings]... │  │
│ └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

**2. Откройте вкладку "Variables"**

```
┌─────────────────────────────────────────────────────────┐
│ Environment Variables                                   │
│ ┌───────────────────────────────────────────────────┐  │
│ │ [+ Add Variable] [RAW Editor]                     │  │
│ │                                                   │  │
│ │ Current Variables:                                │  │
│ │ • DATABASE_URL = postgresql://...  (автоматично) │  │
│ │ • REDIS_URL = redis://...          (автоматично) │  │
│ └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

⚠️ **ВАЖНО**: Railway **автоматически** добавил DATABASE_URL и REDIS_URL!

**3. Обновите DATABASE_URL** - добавьте `+asyncpg`

Текущая версия:
```
postgresql://user:pass@oregon-postgres.railway.app:5432/railway
```

Измените на:
```
postgresql+asyncpg://user:pass@oregon-postgres.railway.app:5432/railway
```

**Как это сделать:**
- Найдите `DATABASE_URL` в списке
- Кликнете на нее (или нажмите Edit)
- Добавьте `+asyncpg` после `postgresql`
- Нажмите Save

```
┌─────────────────────────────────────────────────────────┐
│ Edit Variable                                           │
│ ┌───────────────────────────────────────────────────┐  │
│ │ DATABASE_URL                                      │  │
│ │ [postgresql+asyncpg://user:pass@... ░░]         │  │
│ │                                                   │  │
│ │                        [Save] [Cancel]            │  │
│ └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

**4. Добавьте BOT_TOKEN**

- Кликнете "+ Add Variable"
- Ключ: `BOT_TOKEN`
- Значение: ваш токен от @BotFather (123456789:ABC...)
- Save

**5. Добавьте BOT_USERNAME**

- Кликнете "+ Add Variable"
- Ключ: `BOT_USERNAME`
- Значение: имя вашего бота (без @)
- Save

**6. Опционально: добавьте ADMIN_IDS**

- Кликнете "+ Add Variable"
- Ключ: `ADMIN_IDS`
- Значение: ваш Telegram ID (от @userinfobot)
- Save

```
Результат должен выглядеть так:
┌─────────────────────────────────────────────────────────┐
│ Environment Variables                                   │
│ ├─ BOT_TOKEN = 8446133461:ABC...  ✓                    │
│ ├─ BOT_USERNAME = UPCworld_bot     ✓                    │
│ ├─ DATABASE_URL = postgresql+asyncpg://...  ✓           │
│ ├─ REDIS_URL = redis://...         ✓                    │
│ └─ ADMIN_IDS = 928761243           ✓                    │
└─────────────────────────────────────────────────────────┘
```

---

### ШАГ 6️⃣: Нажмите Redeploy

**1. Откройте вкладку "Deploy"**

```
┌─────────────────────────────────────────────────────────┐
│ Deployments                                             │
│ ┌───────────────────────────────────────────────────┐  │
│ │ [Redeploy] [Rollback to Previous]                │  │
│ │                                                   │  │
│ │ Latest Deployment:                                │  │
│ │ ├─ Status: 🔴 Failed (Error: Configuration)      │  │
│ │ └─ Click to view logs                            │  │
│ └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

**2. Кликнете кнопку "[Redeploy]"**

```
Railway начнет переразвертывание с новыми переменными
```

**3. Дождитесь статуса 🟢**

```
Status will change from:
🔄 Building... → 🔄 Deploying... → 🟢 Running
```

---

### ШАГ 7️⃣: Проверьте логи

**1. Кликнете "View Logs"** или откройте вкладку Logs

```
┌─────────────────────────────────────────────────────────┐
│ Logs                                                    │
│ ┌───────────────────────────────────────────────────┐  │
│ │ [Latest] [Real-time] [Download]                  │  │
│ │                                                   │  │
│ │ 2025-12-26 10:30:45 [INFO] Starting container... │  │
│ │ 2025-12-26 10:30:46 [INFO] Loading app...        │  │
│ │ ...                                               │  │
│ └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

**2. Прокрутите логи вниз - вы должны увидеть:**

```
============================================================
🚀 Starting UPC World Bot v3.0
============================================================
Python version: 3.10.11 (tags/v3.10.11:7d4cc5a, Apr  5 2023, 00:38:17) [MSC v.1929 64 bit (AMD64)]
Working directory: /app

Environment variables:
  BOT_TOKEN: 8446133461***
  BOT_USERNAME: UPCworld_bot
  DATABASE_URL: postgresql+asyncpg://***@oregon-postgres.railway.app:5432/railway
  REDIS_URL: redis://***@redis-railway.up.railway.app:6379
  WEBSITE_URL: https://under-people-club.vercel.app
  LOG_LEVEL: INFO
  LOG_FORMAT: json

Loading configuration...
✅ Configuration loaded successfully
  Bot username: @UPCworld_bot
  Admin IDs: [928761243]
  Log level: INFO
```

✅ **Если видите это - ВСЁ РАБОТАЕТ!** 🎉

---

### ШАГ 8️⃣: Тестируйте в Telegram

**1. Откройте Telegram**

**2. Найдите вашего бота** (например, @UPCworld_bot)

**3. Отправьте команду** `/start`

**4. Бот должен ответить** с приветственным сообщением

✅ **Если бот ответил - deployment успешен!** 🚀

---

## 🆘 ЧТО ЕСЛИ ЧТО-ТО НЕ РАБОТАЕТ?

### Случай 1: Статус 🔴 Failed

**В логах видите**: `❌ CRITICAL ERROR: Failed to load configuration`

**Решение**:
1. Читайте ошибку в логах - она будет точной
2. Проверьте переменные (может что-то не установлено)
3. Нажмите Redeploy
4. Проверьте логи снова

### Случай 2: DATABASE_URL connection refused

**В логах видите**: `could not connect to server`

**Решение**:
1. Убедитесь что DATABASE_URL содержит +asyncpg
2. DATABASE_URL должна быть `postgresql+asyncpg://` (не `postgresql://`)
3. Проверьте что PostgreSQL сервис работает (статус 🟢)

### Случай 3: REDIS_URL не работает

**В логах видите**: `ConnectionError: Error -2 connecting to redis`

**Решение**:
1. Убедитесь что Redis сервис создан и работает (статус 🟢)
2. Проверьте REDIS_URL скопирована правильно
3. REDIS_URL должна начинаться с `redis://`

---

## ✅ ФИНАЛЬНЫЙ ЧЕК-ЛИСТ

После успешного деплоя проверьте:

- [ ] Логи показывают "🚀 Starting UPC World Bot"
- [ ] Логи показывают "✅ Configuration loaded successfully"
- [ ] BOT_USERNAME правильный (@UPCworld_bot)
- [ ] ADMIN_IDS правильные ([928761243])
- [ ] Статус deployment 🟢 (зеленый)
- [ ] Бот отвечает на /start в Telegram
- [ ] Нет красных ошибок в логах

---

## 🎉 ГОТОВО!

Ваш бот успешно развернут на Railway и работает 24/7! 🚀

**Следующие шаги:**
- Добавьте функциональность к боту
- Добавьте вебхук для лучшей производительности
- Настройте мониторинг с помощью Sentry

Удачи! 🎊
